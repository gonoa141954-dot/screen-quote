<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>방충망 자동견적 | 방충망시공소</title>

  <meta name="description" content="30초 셀프견적 · 요약 자동복사 후 오픈채팅 상담" />
  <meta property="og:title" content="방충망 자동견적 | 방충망시공소" />
  <meta property="og:description" content="입력만 하면 금액 확인 · 상담받기 누르면 견적요약 자동복사" />
  <meta property="og:image" content="https://gonoa141954-dot.github.io/screen-quote/hero.png" />

  <style>
    :root{
      --bg:#ffffff; --bg2:#f7f8fb; --card:#ffffff;
      --line:rgba(15,23,42,.10);
      --text:#0f172a; --muted:rgba(15,23,42,.65); --muted2:rgba(15,23,42,.45);
      --brand:#2563eb; --brand2:#06b6d4; --good:#16a34a;
      --shadow: 0 18px 45px rgba(15,23,42,.10);
      --shadow2: 0 10px 28px rgba(15,23,42,.08);
      --r:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 0% 0%, rgba(37,99,235,.10), transparent 60%),
        radial-gradient(900px 500px at 100% 0%, rgba(6,182,212,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:18px 16px 140px;}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:6px 0 14px;}
    .brand{display:flex; flex-direction:column; gap:2px;}
    .brand b{font-size:15px; letter-spacing:-0.2px;}
    .brand span{font-size:12px; color:var(--muted);}
    .status{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.70);
      box-shadow:var(--shadow2);
      font-size:12px; color:var(--muted);
      white-space:nowrap;
    }
    .dot{width:9px;height:9px;border-radius:999px;background:var(--good);box-shadow:0 0 0 4px rgba(22,163,74,.18);}

    .hero{
      border:1px solid var(--line);
      border-radius:var(--r);
      overflow:hidden;
      background:rgba(255,255,255,.82);
      box-shadow:var(--shadow);
    }
    .heroGrid{display:grid; grid-template-columns:1fr;}
    @media (min-width:900px){ .heroGrid{grid-template-columns: 1.15fr .85fr;} }
    .heroMedia{position:relative;min-height:260px;background:#eef2ff;}
    .heroMedia img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.08) contrast(1.04);}
    .heroMedia::after{
      content:""; position:absolute; inset:0;
      background:linear-gradient(to top, rgba(255,255,255,.95), rgba(255,255,255,.10) 55%, rgba(255,255,255,0));
      pointer-events:none;
    }
    .heroContent{padding:18px;display:flex;flex-direction:column;gap:12px;}
    .kicker{
      display:inline-flex; align-items:center; gap:8px; width:max-content;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(37,99,235,.07);
      color:rgba(37,99,235,.95);
      font-weight:1000; font-size:12px;
    }
    .title{margin:0;font-size:22px;letter-spacing:-0.6px;line-height:1.15;font-weight:1000;}
    .sub{margin:0;color:var(--muted);font-size:13px;line-height:1.55;}
    .heroBtns{display:flex;flex-wrap:wrap;gap:10px;margin-top:2px;}
    .btn{
      border:1px solid var(--line);
      background:#fff; color:var(--text);
      padding:12px 14px; border-radius:16px;
      font-weight:1000; font-size:14px;
      cursor:pointer; min-height:46px;
      display:inline-flex; align-items:center; justify-content:center;
      box-shadow: 0 10px 18px rgba(15,23,42,.06);
      transition:transform .08s ease;
    }
    .btnPrimary{
      border-color:transparent;
      background:linear-gradient(135deg, var(--brand), var(--brand2));
      color:white;
      box-shadow: 0 16px 30px rgba(37,99,235,.18);
    }
    .btnSoft{background:rgba(15,23,42,.04);}
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0px)}
    .btnBig{
      font-size:16px;
      padding:14px 16px;
      min-height:54px;
      border-radius:18px;
    }

    .section{margin-top:14px;border:1px solid var(--line);border-radius:var(--r);background:rgba(255,255,255,.92);box-shadow:var(--shadow);overflow:hidden;}
    .sectionHead{padding:16px 16px 12px;border-bottom:1px solid var(--line);background:linear-gradient(180deg, rgba(37,99,235,.06), rgba(255,255,255,0));}
    .sectionHead h2{margin:0;font-size:16px;font-weight:1000;letter-spacing:-0.2px;}
    .sectionHead .desc{margin:6px 0 0;color:var(--muted);font-size:12.8px;line-height:1.5;}
    .sectionBody{padding:14px 16px 16px;}

    .row{display:grid;grid-template-columns:1fr;gap:10px;}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px;}
    input,select,textarea{
      width:100%;border-radius:16px;border:1px solid var(--line);
      background:#fff;color:var(--text);padding:12px 12px;font-size:14px;outline:none;
    }
    input:focus,select:focus,textarea:focus{
      border-color: rgba(37,99,235,.35);
      box-shadow: 0 0 0 4px rgba(37,99,235,.12);
    }
    textarea{min-height:150px;resize:vertical;line-height:1.5;}
    .note{font-size:12.5px;color:var(--muted);line-height:1.5;}

    .chip{
      display:flex; gap:10px; align-items:flex-start;
      border:1px solid var(--line);
      background:rgba(15,23,42,.03);
      border-radius:18px;
      padding:12px;
    }
    .chip input{width:auto;margin-top:2px}
    .chip b{font-weight:1000}

    /* ✅ 예약/영수증 리뷰 체크박스 강조색 */
    .chipReview{
  background: #ffe8f0;
  border: 1px solid #f5c2d3;
  color:#8a1c3a;
    }

    details{border:1px solid var(--line);border-radius:18px;overflow:hidden;background:#fff;box-shadow: var(--shadow2);}
    summary{
      list-style:none;cursor:pointer;padding:14px 12px;font-weight:1000;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      background: linear-gradient(180deg, rgba(15,23,42,.02), rgba(255,255,255,0));
    }
    summary::-webkit-details-marker{display:none;}
    .chev{color:var(--muted2); font-weight:1000;}
    .detailBody{padding:12px;border-top:1px solid var(--line);background:#fff;}

    .result{
      margin-top:14px;border:1px solid var(--line);border-radius:22px;
      background:linear-gradient(180deg, rgba(37,99,235,.06), rgba(255,255,255,0));
      box-shadow: var(--shadow);padding:14px;
    }
    .price{font-size:28px;font-weight:1000;letter-spacing:-0.6px;margin:0;}
    .resultMeta{margin:6px 0 10px;color:var(--muted);font-size:12.5px;line-height:1.5;}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
    .toast{margin-top:8px;color:var(--muted);font-size:12px;min-height:16px;}

    .highlight{border-left:6px solid #FEE500;background:rgba(254,229,0,.22);}
    .highlightTitle{font-weight:1000;font-size:14px;letter-spacing:-0.2px;}

    .kakaoSticky{position:fixed;left:14px;right:14px;bottom:14px;z-index:50;max-width:980px;margin:0 auto;}
    .kakaoBtn{
      width:100%;display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px 14px;border-radius:20px;background:#FEE500;color:#191919;
      border:1px solid rgba(0,0,0,.10);box-shadow: 0 18px 44px rgba(15,23,42,.18);cursor:pointer;
    }
    .kLeft{display:flex;gap:12px;align-items:center;}
    .kBadge{
      width:40px;height:40px;border-radius:999px;display:grid;place-items:center;
      background:#191919;color:#FEE500;font-weight:1000;flex:0 0 auto;
    }
    .kText b{display:block;font-size:14px;font-weight:1000;letter-spacing:-0.2px;}
    .kText span{display:block;font-size:12px;color:rgba(25,25,25,.70);margin-top:2px;}
    .kRight{
      padding:10px 12px;border-radius:14px;background:rgba(25,25,25,.10);
      border:1px solid rgba(25,25,25,.14);font-weight:1000;font-size:12.5px;white-space:nowrap;
    }

    .modalBack{position:fixed;inset:0;background:rgba(15,23,42,.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:80;}
    .modal{width:min(520px, 100%);background:#fff;border:1px solid var(--line);border-radius:22px;box-shadow: var(--shadow);overflow:hidden;}
    .modalTop{padding:14px 14px 10px;border-bottom:1px solid var(--line);background:linear-gradient(180deg, rgba(254,229,0,.22), rgba(255,255,255,0));}
    .modalTop b{font-weight:1000}
    .modalBody{padding:12px 14px 14px;color:var(--muted);font-size:13px;line-height:1.55;}
    .modalBtns{display:flex;gap:10px;padding:0 14px 14px;}
    .modalBtns .btn{flex:1}

    .stepper{display:grid;grid-template-columns:48px 1fr 48px;gap:8px;align-items:center;}
    .stepBtn{
      height:48px;border-radius:16px;border:1px solid var(--line);background:rgba(15,23,42,.04);
      font-weight:1000;font-size:18px;cursor:pointer;display:grid;place-items:center;
      user-select:none;box-shadow: 0 10px 18px rgba(15,23,42,.06);transition:transform .08s ease;
    }
    .stepBtn:hover{transform:translateY(-1px)}
    .stepBtn:active{transform:translateY(0px)}
    .stepInput{height:48px;text-align:center;font-weight:900;font-size:16px;padding:12px 10px;}
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none;margin:0; }
    input[type=number]{ -moz-appearance:textfield; }

    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    @media (max-width:520px){ .grid2{grid-template-columns:1fr;} }

    .list{border:1px solid var(--line);background:#fff;border-radius:18px;overflow:hidden;box-shadow:var(--shadow2);}
    .listHead{display:flex;justify-content:space-between;align-items:center;padding:12px 12px;border-bottom:1px solid var(--line);background:linear-gradient(180deg, rgba(15,23,42,.02), rgba(255,255,255,0));gap:10px;font-weight:1000;}
    .listBody{padding:10px 12px;display:flex;flex-direction:column;gap:8px;}
    .item{display:flex;gap:10px;align-items:flex-start;justify-content:space-between;border:1px solid rgba(15,23,42,.10);background:rgba(15,23,42,.02);border-radius:16px;padding:10px 10px;}
    .item .left{min-width:0;}
    .item b{font-weight:1000}
    .item .meta{font-size:12px;color:var(--muted);margin-top:4px;line-height:1.35;}
    .xBtn{border:1px solid rgba(15,23,42,.12);background:#fff;border-radius:14px;padding:8px 10px;font-weight:1000;cursor:pointer;white-space:nowrap;}

    /* ✅ Hero 모바일 가운데 정렬: 30초/제목/설명/버튼까지 중앙 */
    @media (max-width: 899px){
      .heroContent{
        text-align:center;
        align-items:center;
      }
      .heroBtns{
        justify-content:center;
      }
      .kicker{
        margin:0 auto;
      }
      .note{
        text-align:center;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <b>방충망시공소</b>
        <span>셀프견적 · 요약 자동복사 · 오픈채팅 상담</span>
      </div>
      <div class="status"><span class="dot"></span> 상담 가능</div>
    </div>

    <div class="hero">
      <div class="heroGrid">
        <div class="heroMedia">
          <img src="./hero.png" alt="방충망 자동견적 이미지" />
        </div>
        <div class="heroContent">
          <div class="kicker">⚡ 30초 셀프견적</div>
          <h1 class="title">방충망 자동견적</h1>
          <p class="sub">
            입력만 하면 금액 확인됩니다.
            아래 <b>상담받기</b> 누르면 <b>견적요약이 자동 복사</b>됩니다.
          </p>
          <div class="heroBtns">
            <button class="btn btnPrimary btnBig" id="btnGoQuote">셀프 견적하기</button>
          </div>
          <div class="note">※ 예약/영수증 체크 시 10% 할인 적용됩니다. (방범/추락 안전망은 제외)</div>
        </div>
      </div>
    </div>

    <div class="section" id="quoteSection">
      <div class="sectionHead">
        <h2>셀프 견적</h2>
        <p class="desc">필요한 항목만 펼쳐서 입력하세요.</p>
      </div>

      <div class="sectionBody">
        <div class="highlight" style="border-radius:18px;padding:12px;margin-bottom:12px;border:1px solid rgba(0,0,0,.06);">
          <div class="highlightTitle">✅ 망 교체/안전망 4개 이상 5% 자동 추가 할인</div>
          <div class="note" style="margin-top:4px;">
           
       ✅ 예약/영수증(10%) 할인은 <b>망 교체만 가능</b>
          </div>
        </div>

        <div class="note" style="margin:0 0 12px 0;">
          ✅ <b>현관롤 / PJ롤 / 틀제작</b>은 “개수별 차등 할인(단가 자동 반영)”으로 계산됩니다.
        </div>

        <div class="chip chipReview" style="margin-bottom:12px;">
          <input type="checkbox" id="discount10">
          <div>
            <div><b>예약리뷰</b>or<b>영수증리뷰</b> 약속</div>
            <div class="note">체크하면 총액에서 자동으로 <b style="color:#e11d48;">10% 할인</b></div>
          </div>
        </div>

        <!-- 창문형 -->
        <details id="dWindow">
          <summary><span>창문형 방충망</span><span class="chev">열기/닫기 ▾</span></summary>
          <div class="detailBody">
            <div class="row">
              <div>
                <label>방충망 선택</label>
                <select id="meshType">
                  <option value="micro">미세방충망</option>
                  <option value="hydro_micro">발수코팅 미세방충망</option>
                  <option value="black_stainless_micro">블랙스텐 미세방충망</option>
                </select>
              </div>

              <div>
                <label>소형(개) <span class="note">· 높이 500 이하</span></label>
                <div class="stepper">
                  <button class="stepBtn" type="button" data-step="-1" data-target="cntS">−</button>
                  <input id="cntS" class="stepInput" type="number" min="0" step="1" value="0" inputmode="numeric">
                  <button class="stepBtn" type="button" data-step="1" data-target="cntS">＋</button>
                </div>
              </div>

              <div>
                <label>중형(개) <span class="note">· 높이 1500 이하</span></label>
                <div class="stepper">
                  <button class="stepBtn" type="button" data-step="-1" data-target="cntM">−</button>
                  <input id="cntM" class="stepInput" type="number" min="0" step="1" value="0" inputmode="numeric">
                  <button class="stepBtn" type="button" data-step="1" data-target="cntM">＋</button>
                </div>
              </div>

              <div>
                <label>대형(개) <span class="note">· 높이 2300 이하</span></label>
                <div class="stepper">
                  <button class="stepBtn" type="button" data-step="-1" data-target="cntL">−</button>
                  <input id="cntL" class="stepInput" type="number" min="0" step="1" value="0" inputmode="numeric">
                  <button class="stepBtn" type="button" data-step="1" data-target="cntL">＋</button>
                </div>
              </div>

              <div><label>메모(선택)</label><input id="memo" placeholder="예: 저층/아이 있음/초파리 유입 등"></div>
            </div>
          </div>
        </details>

        <div style="height:12px"></div>

        <!-- ✅ 방범/추락 -->
        <details id="dSafety">
          <summary><span>방범/추락 안전 방충망 (mm 입력)</span><span class="chev">열기/닫기 ▾</span></summary>
          <div class="detailBody">
            <div class="row">
              <div class="note">
                * 가로/세로(mm)와 수량 입력 후 <b>추가</b>를 눌러주세요.<br/>
                * 안전망은 <b>예약/영수증 10% 할인 적용 불가</b> (단, 창문형+안전망 4개 이상이면 5% 추가 할인 적용)
              </div>

              <div class="grid2">
                <div>
                  <label>종류</label>
                  <select id="safetyKind">
                    <option value="crime">방범안전 방충망</option>
                    <option value="fall">추락안전 방충망</option>
                  </select>
                </div>
                <div>
                  <label>망 규격(자동)</label>
                  <input id="safetyGauge" readonly value="0.7mm">
                </div>
              </div>

              <div class="grid2">
                <div>
                  <label>가로(mm)</label>
                  <input id="safetyW" type="number" min="0" step="1" value="0" inputmode="numeric" placeholder="예: 850">
                </div>
                <div>
                  <label>세로(mm)</label>
                  <input id="safetyH" type="number" min="0" step="1" value="0" inputmode="numeric" placeholder="예: 2050">
                </div>
              </div>

              <div>
                <label>수량</label>
                <div class="stepper">
                  <button class="stepBtn" type="button" data-step="-1" data-target="safetyQty">−</button>
                  <input id="safetyQty" class="stepInput" type="number" min="0" step="1" value="0" inputmode="numeric">
                  <button class="stepBtn" type="button" data-step="1" data-target="safetyQty">＋</button>
                </div>
              </div>

              <button class="btn btnPrimary" type="button" id="btnAddSafety">추가</button>
              <div class="note" id="safetyPreview"></div>

              <div class="list" id="safetyListBox" style="display:none;">
                <div class="listHead">
                  <span>추가된 항목</span>
                  <span class="note" id="safetySumText"></span>
                </div>
                <div class="listBody" id="safetyList"></div>
              </div>
            </div>
          </div>
        </details>

        <div style="height:12px"></div>

        <!-- 현관롤 -->
        <details id="dEntrance">
          <summary><span>현관 롤방충망 (개수별 차등 할인)</span><span class="chev">열기/닫기 ▾</span></summary>
          <div class="detailBody">
            <div class="row">
              <div>
                <label>종류 선택</label>
                <select id="entranceType">
                  <option value="normal">현관 롤방충망</option>
                  <option value="micro">현관 미세 롤방충망</option>
                </select>
              </div>

              <div>
                <label>사이즈 선택</label>
                <select id="entranceSize">
                  <option value="under">1000 × 2100 이하</option>
                  <option value="over">1000 × 2100 이상</option>
                </select>
              </div>

              <div>
                <label>개수</label>
                <div class="stepper">
                  <button class="stepBtn" type="button" data-step="-1" data-target="entranceQty">−</button>
                  <input id="entranceQty" class="stepInput" type="number" min="0" step="1" value="0" inputmode="numeric">
                  <button class="stepBtn" type="button" data-step="1" data-target="entranceQty">＋</button>
                </div>
              </div>

              <div class="note">* 개수에 따라 <b>단가가 자동으로 내려갑니다</b>. (5개 이후도 5개 단가로 고정)</div>
              <div class="note">* 각 파이프 작업 필요 시 비용 추가</div>
            </div>
          </div>
        </details>

        <div style="height:12px"></div>

        <!-- PJ 롤 (분리/비움) -->
        <details id="dPJ">
          <summary><span>PJ 롤 방충망 (별도 견적 문의)</span><span class="chev">열기/닫기 ▾</span></summary>
          <div class="detailBody">
            <div class="note">
              * PJ 롤은 현장 조건이 다양해서 자동견적은 잠시 비워두었습니다.<br/>
              * 오픈채팅으로 문의 주시면 빠르게 안내드릴게요.
            </div>
          </div>
        </details>

        <div style="height:12px"></div>

        <!-- 알미늄 -->
        <details id="dAl">
          <summary><span>알미늄 틀 제작(미세망 포함) (개수별 차등 할인)</span><span class="chev">열기/닫기 ▾</span></summary>
          <div class="detailBody">
            <div class="row">
              <div class="note">
                * 소/중: 1개 10만 → 2개(개당 9만) → 3개 이상(개당 8만)<br/>
                * 대창: 1개 14만 → 2개(12만) → 3개(11만) → 4개 이상(개당 10만)
              </div>

              <div>
                <label>소/중 (합계 개수) <span class="note">· 높이 1500 이하</span></label>
                <div class="stepper">
                  <button class="stepBtn" type="button" data-step="-1" data-target="alSM">−</button>
                  <input id="alSM" class="stepInput" type="number" min="0" step="1" value="0" inputmode="numeric">
                  <button class="stepBtn" type="button" data-step="1" data-target="alSM">＋</button>
                </div>
              </div>

              <div>
                <label>대창 (개수) <span class="note">· 높이 2200 이하</span></label>
                <div class="stepper">
                  <button class="stepBtn" type="button" data-step="-1" data-target="alL">−</button>
                  <input id="alL" class="stepInput" type="number" min="0" step="1" value="0" inputmode="numeric">
                  <button class="stepBtn" type="button" data-step="1" data-target="alL">＋</button>
                </div>
              </div>
            </div>
          </div>
        </details>

        <div style="height:12px"></div>

        <!-- 하이샤시 -->
        <details id="dHS">
          <summary><span>하이샤시 틀 제작(미세망 포함) (개수별 차등 할인)</span><span class="chev">열기/닫기 ▾</span></summary>
          <div class="detailBody">
            <div class="row">
              <div class="note">
                * 알미늄과 동일 가격 적용<br/>
                * 소/중: 1개 10만 → 2개(개당 9만) → 3개 이상(개당 8만)<br/>
                * 대창: 1개 14만 → 2개(12만) → 3개(11만) → 4개 이상(개당 10만)
              </div>

              <div>
                <label>소/중 (합계 개수) <span class="note">· 높이 1500 이하</span></label>
                <div class="stepper">
                  <button class="stepBtn" type="button" data-step="-1" data-target="hsSM">−</button>
                  <input id="hsSM" class="stepInput" type="number" min="0" step="1" value="0" inputmode="numeric">
                  <button class="stepBtn" type="button" data-step="1" data-target="hsSM">＋</button>
                </div>
              </div>

              <div>
                <label>대창 (개수) <span class="note">· 높이 2200 이하</span></label>
                <div class="stepper">
                  <button class="stepBtn" type="button" data-step="-1" data-target="hsL2">−</button>
                  <input id="hsL2" class="stepInput" type="number" min="0" step="1" value="0" inputmode="numeric">
                  <button class="stepBtn" type="button" data-step="1" data-target="hsL2">＋</button>
                </div>
              </div>
            </div>
          </div>
        </details>

        <div class="result">
          <p class="price" id="resultPrice">0원</p>
          <div class="resultMeta" id="resultNote">개수 입력하면 자동으로 계산됩니다.</div>

          <label>고객에게 보낼 요약(자동 생성)</label>
          <textarea id="summary" readonly></textarea>

          <div class="btnRow">
            <button class="btn btnPrimary" id="btnCopy">요약 복사</button>
            <button class="btn" id="btnReset">초기화</button>
          </div>
          <div class="toast" id="toast"></div>

          <div class="note" style="margin-top:8px;">
            아래 <b>상담받기</b> 버튼을 누르면 <b>요약이 자동 복사</b>되고, 오픈채팅으로 이동합니다.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- modal -->
  <div class="modalBack" id="modalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalTop"><b id="modalTitle">견적요약 자동복사</b></div>
      <div class="modalBody" id="modalBody">복사 완료! 오픈채팅으로 이동하면 채팅창에 붙여넣기만 하시면 됩니다.</div>
      <div class="modalBtns">
        <button class="btn btnPrimary" id="btnGoKakao">오픈채팅으로 이동</button>
        <button class="btn btnSoft" id="btnCloseModal">닫기</button>
      </div>
    </div>
  </div>

  <!-- sticky kakao -->
  <div class="kakaoSticky">
    <button class="kakaoBtn" id="kakaoConsultBtn" type="button">
      <div class="kLeft">
        <div class="kBadge">톡</div>
        <div class="kText">
          <b>카카오톡 오픈채팅 상담</b>
          <span>누르면 견적요약 자동복사</span>
        </div>
      </div>
      <div class="kRight">상담받기</div>
    </button>
  </div>

<script>
const KAKAO_URL = "https://open.kakao.com/o/symXVtei";

const CONFIG = {
  UNIT_PRICE_WINDOW: {
    micro:                 { S: 10000, M: 30000, L: 50000 },
    hydro_micro:           { S: 20000, M: 40000, L: 60000 },
    black_stainless_micro: { S: 25000, M: 50000, L: 70000 },
  },

  // 예약/영수증 (10%) - ✅ 방범/추락 안전망 제외
  REVIEW_DISCOUNT_RATE: 0.10,

  // ✅ 창문형 + 안전망 합산 4개 이상이면 5% 추가 할인
  WINDOW_SAFETY_QTY_DISCOUNT_MIN: 4,
  WINDOW_SAFETY_QTY_DISCOUNT_RATE: 0.05,

  // 안전/추락 소비자가격 표(내부 계산용)
  SAFETY_CONSUMER_TABLE: {
    "0.4": {
      "0.3":150000,"0.4":150000,"0.5":150000,"0.6":150000,
      "0.7":160000,"0.8":170000,"0.9":180000,"1.0":190000,
      "1.1":200000,"1.2":210000,"1.3":220000,"1.4":230000,
      "1.5":240000,"1.6":250000,"1.7":260000,"1.8":270000,
      "1.9":280000,"2.0":290000,"2.1":300000,"2.2":310000,
      "2.3":320000,"2.4":330000,"2.5":340000,"2.6":350000,
      "2.7":360000,"2.8":370000,"2.9":380000,"3.0":390000
    },
    "0.7": {
      "0.3":180000,"0.4":180000,"0.5":180000,"0.6":180000,
      "0.7":190000,"0.8":200000,"0.9":210000,"1.0":220000,
      "1.1":230000,"1.2":240000,"1.3":250000,"1.4":260000,
      "1.5":270000,"1.6":280000,"1.7":290000,"1.8":300000,
      "1.9":310000,"2.0":320000,"2.1":330000,"2.2":340000,
      "2.3":350000,"2.4":360000,"2.5":370000,"2.6":380000,
      "2.7":390000,"2.8":400000,"2.9":410000,"3.0":420000
    }
  },
  SAFETY_MIN_M2: 0.3,
  SAFETY_MAX_M2: 3.0
};

const $ = (id) => document.getElementById(id);
const fmt = (n) => (Math.round(n)).toLocaleString("ko-KR") + "원";
const clampInt = (v) => Math.max(0, Number.isFinite(v) ? Math.floor(v) : 0);

function meshLabel(k){
  return ({
    micro: "미세방충망",
    hydro_micro: "발수코팅 미세방충망",
    black_stainless_micro: "블랙스텐 미세방충망"
  })[k] || k;
}
function entranceTypeLabel(k){
  return ({
    normal: "현관 롤방충망",
    micro: "현관 미세 롤방충망",
  })[k] || k;
}
function entranceSizeLabel(k){
  return (k === "under") ? "1000×2100 이하" : "1000×2100 이상";
}
function safetyKindLabel(k){
  return (k === "crime") ? "방범안전 방충망" : "추락안전 방충망";
}
function safetyGaugeForKind(kind){
  return (kind === "crime") ? "0.7" : "0.4";
}

function toast(msg){
  $("toast").textContent = msg;
  setTimeout(()=>{ $("toast").textContent = ""; }, 2400);
}

function ceilToTenth(area){ return Math.ceil(area * 10) / 10; }
function safetyRoundedM2FromMM(wMm, hMm){
  const raw = (wMm * hMm) / 1_000_000;
  let rounded = ceilToTenth(raw);
  if(rounded < CONFIG.SAFETY_MIN_M2) rounded = CONFIG.SAFETY_MIN_M2;
  rounded = Number(rounded.toFixed(1));
  return { raw, rounded };
}
function safetyPriceByGaugeM2(gauge, roundedM2){
  const key = roundedM2.toFixed(1);
  const table = CONFIG.SAFETY_CONSUMER_TABLE[gauge];
  return table ? (table[key] ?? null) : null;
}

/* ✅ 현관롤: 개수별 단가 */
function clampQty1to5(q){ return Math.max(1, Math.min(5, q)); }

function entranceUnitPrice(type, size, qty){
  const q = clampQty1to5(qty);

  // normal
  if(type === "normal" && size === "under"){
    const table = [160000,150000,130000,130000,120000];
    return table[q-1];
  }
  if(type === "normal" && size === "over"){
    const table = [180000,170000,160000,150000,140000];
    return table[q-1];
  }

  // micro
  if(type === "micro" && size === "under"){
    const table = [180000,170000,160000,150000,140000];
    return table[q-1];
  }
  if(type === "micro" && size === "over"){
    const table = [200000,190000,180000,170000,160000];
    return table[q-1];
  }

  return 0;
}

/* ✅ 틀제작: 개수별 단가(알미늄/하이샤시 동일) */
function frameUnitPriceSM(qty){
  if(qty >= 3) return 80000;
  if(qty === 2) return 90000;
  if(qty === 1) return 100000;
  return 0;
}
function frameUnitPriceL(qty){
  if(qty >= 4) return 100000;
  if(qty === 3) return 110000;
  if(qty === 2) return 120000;
  if(qty === 1) return 140000;
  return 0;
}

/* 안전/추락 누적 리스트 */
let safetyItems = []; // {id, kind, gauge, w, h, qty, rawM2, roundedM2, unitPrice}

function safetySumTotal(){
  return safetyItems.reduce((acc, it)=> acc + (it.unitPrice * it.qty), 0);
}
function safetySumQty(){
  return safetyItems.reduce((acc, it)=> acc + it.qty, 0);
}
function renderSafetyList(){
  const box = $("safetyListBox");
  const list = $("safetyList");

  if(safetyItems.length === 0){
    box.style.display = "none";
    list.innerHTML = "";
    $("safetySumText").textContent = "";
    return;
  }

  box.style.display = "block";
  list.innerHTML = "";

  let sum = 0;

  safetyItems.forEach(item=>{
    const lineTotal = item.unitPrice * item.qty;
    sum += lineTotal;

    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="left">
        <b>${safetyKindLabel(item.kind)} · ${item.gauge}mm</b>
        <div class="meta">
          ${item.w}×${item.h}mm / ${item.qty}개<br/>
          ${fmt(item.unitPrice)} × ${item.qty} = <b>${fmt(lineTotal)}</b>
        </div>
      </div>
      <button class="xBtn" type="button" data-del-safety="${item.id}">삭제</button>
    `;
    list.appendChild(div);
  });

  $("safetySumText").textContent = `합계 ${fmt(sum)}`;
}

function buildSummary(ctx){
  const {
    totalFinal,
    totalConsumer,
    reviewDiscountOn,
    windowSafetyQtyDiscountApplied,
    windowSafetyQty,
    windowConsumer,
    safetyConsumer,
    entranceConsumer,
    alConsumer,
    hsConsumer,
    eligibleConsumer,
    windowSafetyQtyDiscountRate,
    eligibleAfterAllDiscounts,
    entranceQty,
    entranceUnit,
    alSM, alL, hsSM, hsL2,
    alUnitSM, alUnitL, hsUnitSM, hsUnitL
  } = ctx;

  const meshKey = $("meshType").value;
  const cntS = clampInt(parseFloat($("cntS").value));
  const cntM = clampInt(parseFloat($("cntM").value));
  const cntL = clampInt(parseFloat($("cntL").value));
  const memo = ($("memo").value || "").trim();

  const entranceType = $("entranceType").value;
  const entranceSize = $("entranceSize").value;

  const lines = [];
  lines.push(`창문형: ${meshLabel(meshKey)}`);
  lines.push(`창 개수: 소 ${cntS}(높이 500↓) / 중 ${cntM}(높이 1500↓) / 대 ${cntL}(높이 2300↓)`);

  if(safetyItems.length){
    lines.push(`방범/추락 안전 방충망 (리뷰 10% 할인 제외):`);
    safetyItems.forEach((it, idx)=>{
      const lineTotal = it.unitPrice * it.qty;
      lines.push(`- ${idx+1}) ${safetyKindLabel(it.kind)} ${it.gauge}mm / ${it.w}×${it.h}mm / ${it.qty}개 / ${fmt(it.unitPrice)}×${it.qty}=${fmt(lineTotal)}`);
    });
  }

  if(entranceQty>0){
    lines.push(`현관롤: ${entranceTypeLabel(entranceType)} / ${entranceSizeLabel(entranceSize)} / ${entranceQty}개`);
    lines.push(`- 단가(자동): ${fmt(entranceUnit)} / 합계: ${fmt(entranceConsumer)}`);
    lines.push(`* 각 파이프 작업 필요 시 비용 추가`);
  }

  if(alSM+alL>0){
    lines.push(`알미늄 틀 제작:`);
    if(alSM>0) lines.push(`- 소/중 ${alSM}개 / 단가 ${fmt(alUnitSM)} / 합계 ${fmt(alUnitSM * alSM)}`);
    if(alL>0)  lines.push(`- 대창 ${alL}개 / 단가 ${fmt(alUnitL)} / 합계 ${fmt(alUnitL * alL)}`);
  }

  if(hsSM+hsL2>0){
    lines.push(`하이샤시 틀 제작:`);
    if(hsSM>0) lines.push(`- 소/중 ${hsSM}개 / 단가 ${fmt(hsUnitSM)} / 합계 ${fmt(hsUnitSM * hsSM)}`);
    if(hsL2>0) lines.push(`- 대창 ${hsL2}개 / 단가 ${fmt(hsUnitL)} / 합계 ${fmt(hsUnitL * hsL2)}`);
  }

  const qtyDiscTxt = windowSafetyQtyDiscountApplied
    ? `${Math.round(windowSafetyQtyDiscountRate*100)}% 적용`
    : "미적용";

  lines.push(`창문형+안전망 합산 개수: ${windowSafetyQty}개 / 4개 이상 5% 추가 할인: ${qtyDiscTxt}`);
  lines.push(`소비자가격(정가): ${fmt(totalConsumer)}`);
  lines.push(`예약/영수증리뷰 10%: ${reviewDiscountOn ? "적용(안전망 제외)" : "미적용"}`);
  if(reviewDiscountOn){
    lines.push(`- 리뷰할인 적용대상 합계: ${fmt(eligibleConsumer)} (안전망 ${fmt(safetyConsumer)} 제외)`);
  }
  lines.push(`최종 자동견적: ${fmt(totalFinal)}`);
  lines.push(`메모: ${memo || "없음"}`);

  return "자동견적 보고 연락드려요.\n" + lines.join("\n");
}

function calc(){
  const reviewDiscountOn = $("discount10").checked;

  const meshKey = $("meshType").value;
  const cntS = clampInt(parseFloat($("cntS").value));
  const cntM = clampInt(parseFloat($("cntM").value));
  const cntL = clampInt(parseFloat($("cntL").value));

  // 1) 창문형(소비자)
  const up = CONFIG.UNIT_PRICE_WINDOW[meshKey] || CONFIG.UNIT_PRICE_WINDOW.micro;
  const windowConsumer = (up.S * cntS) + (up.M * cntM) + (up.L * cntL);
  const windowQty = (cntS + cntM + cntL);

  // 2) 안전망(소비자) - 리뷰 10% 제외
  const safetyConsumer = safetySumTotal();
  const safetyQty = safetySumQty();

  // ✅ 창문형 + 안전망 합산 4개 이상이면 5% 추가 할인 (이 두 항목에만)
  const windowSafetyQty = windowQty + safetyQty;
  const windowSafetyQtyDiscountApplied = (windowSafetyQty >= CONFIG.WINDOW_SAFETY_QTY_DISCOUNT_MIN);
  const windowSafetyQtyDiscountRate = windowSafetyQtyDiscountApplied ? CONFIG.WINDOW_SAFETY_QTY_DISCOUNT_RATE : 0;

  const windowAfterQty = windowConsumer * (1 - windowSafetyQtyDiscountRate);
  const safetyAfterQty = safetyConsumer * (1 - windowSafetyQtyDiscountRate);

  // 3) 현관롤: 개수별 단가 (✅ 리뷰 10% 제외)
  const entranceType = $("entranceType").value;
  const entranceSize = $("entranceSize").value;
  const entranceQty = clampInt(parseFloat($("entranceQty").value));
  let entranceConsumer = 0;
  let entranceUnit = 0;
  if(entranceQty > 0){
    entranceUnit = entranceUnitPrice(entranceType, entranceSize, entranceQty);
    entranceConsumer = entranceUnit * entranceQty;
  }

  // 4) 알미늄 틀: 개수별 단가 (✅ 리뷰 10% 제외)
  const alSM = clampInt(parseFloat($("alSM").value));
  const alL  = clampInt(parseFloat($("alL").value));
  const alUnitSM = frameUnitPriceSM(alSM);
  const alUnitL  = frameUnitPriceL(alL);
  const alConsumer = (alUnitSM * alSM) + (alUnitL * alL);

  // 5) 하이샤시 틀: 개수별 단가 (✅ 리뷰 10% 제외)
  const hsSM = clampInt(parseFloat($("hsSM").value));
  const hsL2 = clampInt(parseFloat($("hsL2").value));
  const hsUnitSM = frameUnitPriceSM(hsSM);
  const hsUnitL  = frameUnitPriceL(hsL2);
  const hsConsumer = (hsUnitSM * hsSM) + (hsUnitL * hsL2);

  // 총 소비자가격(정가) = 창문형 + 안전 + 현관 + 틀
  const totalConsumer = windowConsumer + safetyConsumer + entranceConsumer + alConsumer + hsConsumer;

  // ✅ 리뷰 10%는 "창문형"만 적용 (안전망/현관롤/틀제작 제외)
  const windowAfterReview = reviewDiscountOn
    ? (windowAfterQty * (1 - CONFIG.REVIEW_DISCOUNT_RATE))
    : windowAfterQty;

  const any =
    (windowQty + safetyQty + entranceQty + alSM + alL + hsSM + hsL2) > 0;

  // 최종 = 창문형(10% 여부) + 안전망(5% 여부) + 현관롤 + 틀제작
  const totalFinal = any
    ? (windowAfterReview + safetyAfterQty + entranceConsumer + alConsumer + hsConsumer)
    : 0;

  $("resultPrice").textContent = fmt(totalFinal);

  let note = any ? "입력 기준 자동견적입니다." : "개수 입력하면 자동 계산됩니다.";
  if(any){
    const parts = [];
    if(windowSafetyQtyDiscountApplied){
      parts.push(`✅ 창문형+안전망 4개 이상 5% 추가 할인 적용`);
    }
    if(reviewDiscountOn){
      parts.push(`✅ 예약/영수증 10% 할인 적용 (창문형만)`);
    }
    if(parts.length) note = parts.join(" / ");
  }
  $("resultNote").textContent = note;

  // summary에서 쓰는 값들
  const eligibleConsumer = windowAfterQty; // ✅ 리뷰할인 적용대상(창문형만)

  const ctx = {
    totalFinal,
    totalConsumer,
    reviewDiscountOn,
    windowSafetyQtyDiscountApplied,
    windowSafetyQty,
    windowConsumer,
    safetyConsumer,
    entranceConsumer,
    alConsumer,
    hsConsumer,
    eligibleConsumer,
    windowSafetyQtyDiscountRate,
    eligibleAfterAllDiscounts: windowAfterReview, // ✅ 참고용
    entranceQty,
    entranceUnit,
    alSM, alL, hsSM, hsL2,
    alUnitSM, alUnitL, hsUnitSM, hsUnitL
  };

  $("summary").value = buildSummary(ctx);
  return { summary: $("summary").value, any };
}


async function copyText(text){
  try{
    await navigator.clipboard.writeText(text);
    return true;
  }catch(e){
    const ta = $("summary");
    ta.removeAttribute("readonly");
    ta.value = text;
    ta.select();
    ta.setSelectionRange(0, 99999);
    const ok = document.execCommand("copy");
    ta.setAttribute("readonly","readonly");
    return ok;
  }
}

function applyStep(targetId, delta){
  const el = $(targetId);
  if(!el) return;
  const cur = clampInt(parseFloat(el.value));
  const next = Math.max(0, cur + delta);
  el.value = next;
  el.dispatchEvent(new Event("input", { bubbles:true }));
}

function openModal(msg){
  $("modalBody").textContent = msg;
  $("modalBack").style.display = "flex";
  $("modalBack").setAttribute("aria-hidden","false");
}
function closeModal(){
  $("modalBack").style.display = "none";
  $("modalBack").setAttribute("aria-hidden","true");
}

function updateSafetyGaugeUI(){
  const kind = $("safetyKind").value;
  const g = safetyGaugeForKind(kind);
  $("safetyGauge").value = `${g}mm`;
  safetyPreview();
}

function safetyPreview(){
  const kind = $("safetyKind").value;
  const gauge = safetyGaugeForKind(kind);
  const w = clampInt(parseFloat($("safetyW").value));
  const h = clampInt(parseFloat($("safetyH").value));
  const qty = clampInt(parseFloat($("safetyQty").value));

  if(w<=0 || h<=0 || qty<=0){
    $("safetyPreview").textContent = "";
    return;
  }

  const { rounded } = safetyRoundedM2FromMM(w, h);
  if(rounded > CONFIG.SAFETY_MAX_M2){
    $("safetyPreview").textContent = "⚠️ 입력 범위를 초과했습니다 — 오픈채팅 문의";
    return;
  }

  const unit = safetyPriceByGaugeM2(gauge, rounded);
  if(unit == null){
    $("safetyPreview").textContent = "⚠️ 금액 계산이 어려워요 — 오픈채팅 문의";
    return;
  }

  const lineTotal = unit * qty;
  $("safetyPreview").textContent =
    `미리보기: ${safetyKindLabel(kind)} ${gauge}mm / ${w}×${h}mm / ${fmt(unit)}×${qty} = ${fmt(lineTotal)}`;
}

function wire(){
  // stepper + delete
  document.addEventListener("click", (e)=>{
    const btn = e.target.closest("[data-step][data-target]");
    if(btn){
      const delta = parseInt(btn.getAttribute("data-step"), 10);
      const targetId = btn.getAttribute("data-target");
      applyStep(targetId, delta);
      if(targetId === "safetyQty") safetyPreview();
      calc();
      return;
    }

    const del = e.target.closest("[data-del-safety]");
    if(del){
      const id = del.getAttribute("data-del-safety");
      safetyItems = safetyItems.filter(x => x.id !== id);
      renderSafetyList();
      calc();
      return;
    }
  });

  // calc trigger
  [
    "discount10",
    "meshType","cntS","cntM","cntL","memo",
    "entranceType","entranceSize","entranceQty",
    "alSM","alL",
    "hsSM","hsL2"
  ].forEach(id => $(id).addEventListener("input", calc));

  // safety preview
  ["safetyW","safetyH","safetyQty"].forEach(id=>{
    $(id).addEventListener("input", ()=>{
      if(id === "safetyQty"){
        $(id).value = clampInt(parseFloat($(id).value));
      }
      safetyPreview();
    });
  });

  $("safetyKind").addEventListener("input", updateSafetyGaugeUI);

  // add safety
  $("btnAddSafety").addEventListener("click", ()=>{
    const kind = $("safetyKind").value;
    const gauge = safetyGaugeForKind(kind);

    const w = clampInt(parseFloat($("safetyW").value));
    const h = clampInt(parseFloat($("safetyH").value));
    const qty = clampInt(parseFloat($("safetyQty").value));

    if(w<=0 || h<=0){ toast("가로/세로(mm)를 입력해주세요."); return; }
    if(qty<=0){ toast("수량을 1개 이상으로 입력해주세요."); return; }

    const { raw, rounded } = safetyRoundedM2FromMM(w, h);
    if(rounded > CONFIG.SAFETY_MAX_M2){ toast("입력 범위를 초과했습니다. 오픈채팅 문의"); return; }

    const unit = safetyPriceByGaugeM2(gauge, rounded);
    if(unit == null){ toast("금액 계산이 어려워요. 오픈채팅 문의"); return; }

    safetyItems.push({
      id: String(Date.now()) + "_" + Math.random().toString(16).slice(2),
      kind, gauge, w, h, qty,
      rawM2: raw, roundedM2: rounded,
      unitPrice: unit
    });

    renderSafetyList();
    calc();
    toast("추가 완료");

    $("safetyW").value = 0;
    $("safetyH").value = 0;
    safetyPreview();
  });

  // copy
  $("btnCopy").addEventListener("click", async ()=>{
    const { summary } = calc();
    const ok = await copyText(summary);
    toast(ok ? "복사 완료! 오픈채팅에 붙여넣기 하면 끝" : "복사 실패 — 요약을 길게 눌러 복사해주세요");
  });

  // reset
  $("btnReset").addEventListener("click", ()=>{
    $("discount10").checked = false;

    $("meshType").value = "micro";
    $("cntS").value = 0; $("cntM").value = 0; $("cntL").value = 0;
    $("memo").value = "";

    $("safetyKind").value = "crime";
    updateSafetyGaugeUI();
    $("safetyW").value = 0;
    $("safetyH").value = 0;
    $("safetyQty").value = 0;
    safetyItems = [];
    renderSafetyList();
    safetyPreview();

    $("entranceType").value = "normal";
    $("entranceSize").value = "under";
    $("entranceQty").value = 0;

    $("alSM").value = 0; $("alL").value = 0;
    $("hsSM").value = 0; $("hsL2").value = 0;

    calc();
    toast("초기화 완료");
  });

  // scroll button
  $("btnGoQuote").addEventListener("click", ()=>{
    $("dWindow").open = true;
    $("quoteSection").scrollIntoView({ behavior:"smooth", block:"start" });
    setTimeout(()=> $("meshType").focus(), 450);
  });

  // kakao consult
  $("kakaoConsultBtn").addEventListener("click", async ()=>{
    const { summary, any } = calc();
    if(!any){
      openModal("아직 입력된 항목이 없어요. 아래에서 입력 후 다시 ‘상담받기’를 눌러주세요.");
      $("btnGoKakao").style.display = "none";
      $("quoteSection").scrollIntoView({ behavior:"smooth", block:"start" });
      $("dWindow").open = true;
      return;
    }

    const ok = await copyText(summary);
    $("btnGoKakao").style.display = "inline-flex";
    if(ok){
      openModal("복사 완료! 오픈채팅으로 이동하면 채팅창에 ‘붙여넣기’만 하시면 됩니다.");
      setTimeout(()=> window.open(KAKAO_URL, "_blank", "noopener"), 650);
    }else{
      openModal("복사가 막힌 기기예요. 아래 요약을 길게 눌러 복사한 뒤, 오픈채팅으로 이동해주세요.");
    }
  });

  $("btnGoKakao").addEventListener("click", ()=> window.open(KAKAO_URL, "_blank", "noopener"));
  $("btnCloseModal").addEventListener("click", closeModal);
  $("modalBack").addEventListener("click", (e)=>{ if(e.target === $("modalBack")) closeModal(); });

  // init
  updateSafetyGaugeUI();
  calc();
}
wire();
</script>
</body>
</html>












